services:
  # The Analytics Engine
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: ids_clickhouse
    ports:
      - "8123:8123" # HTTP port for Next.js
      - "9000:9000" # TCP port for Native clients (Vector)
    volumes:
      - ./packages/database/data:/var/lib/clickhouse
      - ./packages/database/init:/docker-entrypoint-initdb.d
    ulimits:
      nofile:
        soft: 262144
        hard: 262144     
    environment:
          CLICKHOUSE_DB: ids
          CLICKHOUSE_USER: default
          CLICKHOUSE_PASSWORD: admin  # In production, we'd use a .env file
          CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: 1

  # The Dashboard (We will scaffold this in a moment)
  # web:
  #   build: ./apps/web
  #   ports:
  #     - "3000:3000"